<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ‰“å¡è™•ç†ä¸­...</title>
  <style>
    body {
      background-color: #e0e0e0;
      font-size: 60px;
      font-weight: bold;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      flex-direction: column;
      text-align: center;
      overflow: hidden;
    }
    .star {
      position: absolute;
      width: 15px;
      height: 15px;
      background: gold;
      border-radius: 50%;
      animation: twinkle 2s infinite;
      pointer-events: none;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.8); }
    }
  </style>
</head>
<body>
  <p>è³‡æ–™è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>

  <script>
    // æ˜Ÿæ˜Ÿå‹•ç•«æ•ˆæœ
    function createStar() {
      const star = document.createElement("div");
      star.className = "star";
      star.style.left = Math.random() * window.innerWidth + "px";
      star.style.top = Math.random() * window.innerHeight + "px";
      document.body.appendChild(star);
      setTimeout(() => document.body.removeChild(star), 2000);
    }
    setInterval(createStar, 150);

    // å–å¾— URL åƒæ•¸
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    const nfcid = getQueryParam("nfcid");

    navigator.geolocation.getCurrentPosition(async pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbyXC1k0bSb6l1IaxQJkxqUsfKxVY1t7oUugwFK3K-2jf8ZJua-Yf82QgAlaYvxBK3jD4g/exec", {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify({
            action: "createRecord",
            nfcid: nfcid,
            lat: lat,
            lon: lon
          })
        });

        const json = await res.json();
        const { name, time, status, errorMessage } = json;

        document.body.innerHTML = `
          <p>${errorMessage || 'âœ… æ‰“å¡æˆåŠŸï¼'}</p>
          <p>ğŸ‘¤ å§“åï¼š${name}</p>
          <p>ğŸ•’ æ™‚é–“ï¼š${time}</p>
          <p>ğŸ“Œ ç‹€æ…‹ï¼š${status}</p>
        `;
      } catch (err) {
        document.body.innerHTML = `<p style="color: red;">âŒ éŒ¯èª¤ï¼š${err.message}</p>`;
      }
    }, err => {
      document.body.innerHTML = `<p style="color: red;">âŒ ç„¡æ³•å–å¾—å®šä½ï¼š${err.message}</p>`;
    }, {
      enableHighAccuracy: true,
      timeout: 10000
    });
  </script>
</body>
</html>
